<h1> Flights</h1>

<hr>
<% if user_signed_in? %>
<div class="row">
  <h3>the best deal MP$:<%= @best_flight['miles_per_dollar'] %></h3>
  Price<%= @best_flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i + 0.0 %>
  <br>
  Depature Time<%= @best_flight['slice'][0]['segment'][0]['leg'][0]['departureTime'] %>

    <%= form_tag action: 'save_flight', controller: 'user_flights' do %>
        <%= hidden_field_tag 'mpd', @best_flight['miles_per_dollar'] %>
        <%= submit_tag 'submit'%>
    <% end %>
  <!-- <button class="btn btn-primary" type="button" name="button">Save this flight</button> -->



  <hr>

      <strong><%= @best_flight['saleTotal'] %></strong> ______ <%= @best_flight['slice'][0]['segment'][0]['leg'][0]['departureTime'] %> - <%= @best_flight['slice'][0]['segment'][0]['leg'][0]['arrivalTime'] %> ____
      <% if @best_flight['slice'][0]['segment'].length === 0 %>
         "Nonstop"
         <% end %>
       Origin =  <%= @best_flight['slice'][0]['segment'][0]['leg'][0]['origin'] %>
       <br>
      Final Destination =  <%= @best_flight['slice'][0]['segment'].last['leg'][0]['destination'] %>
      <br>

      Number of stops =  <%= @best_flight['slice'][0]['segment'].length - 1 %>
      <br>



      <br>
      Total Travel Time: <%= @best_flight['slice'][0]['duration'] %> - Minutes
      <br>
      Airline Carrier <%= @best_flight['slice'][0]['segment'][0]['flight']['carrier'] %>
      <br>
      Airline Number <%= @best_flight['slice'][0]['segment'][0]['flight']['number'] %>
      <br>
      Price: <%= @best_flight['saleTotal'] %>
      <br>
      Mileage: <%= @best_flight['slice'][0]['segment'][0]['leg'][0]['mileage'] %>
      <br>
      Arrival Time: <%= @best_flight['slice'][0]['segment'][0]['leg'][0]['arrivalTime'] %>
      <br>
      Departure Time: <%= @best_flight['slice'][0]['segment'][0]['leg'][0]['departureTime'] %>
      <br>


<hr><hr>


  <div class="col-md-4">

    <h4> > 10 mp$</h4>
    <h4> These Flights are GREAT!!!</h4>
    <% @flights['trips']['tripOption'].each do |flight| %>
    <!-- #code to not divide by zero -->
      <% if (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i) != 0  %>
        <!-- #check ratio -->
        <% if ((flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i + 0.0) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i + 0.0)).round(2) > 10  %>
          <div class="flight-div">
            <!-- This returns the final destination, if trips have a stop -->




            <strong><%= flight['saleTotal'] %></strong> ______ <%= flight['slice'][0]['segment'][0]['leg'][0]['departureTime'] %> - <%= flight['slice'][0]['segment'][0]['leg'][0]['arrivalTime'] %> ____
            <% if flight['slice'][0]['segment'].length === 0 %>
               "Nonstop"
               <% end %>
             Origin =  <%= flight['slice'][0]['segment'][0]['leg'][0]['origin'] %>
             <br>
          Final Destination =  <%= flight['slice'][0]['segment'].last['leg'][0]['destination'] %>
            <br>

          Number of stops =  <%= flight['slice'][0]['segment'].length - 1 %>
            <br>

            <%# flight['slice'][0]['segment'].each do |segment| %>
              <!-- Destination(not accurate if multiple stops)-   -->
              <%# segment['leg'][0]['destination'] %>
              <!-- <br> -->
            <%# end %>


            <br>
            Total Travel Time: <%= flight['slice'][0]['duration'] %> - Minutes
            <br>
            Airline Carrier <%= flight['slice'][0]['segment'][0]['flight']['carrier'] %>
            <br>
            Airline Number <%= flight['slice'][0]['segment'][0]['flight']['number'] %>
            <br>
            Price: <%= flight['saleTotal'] %>
            <br>
            Mileage: <%= flight['slice'][0]['segment'][0]['leg'][0]['mileage'] %>
            <br>
            Arrival Time: <%= flight['slice'][0]['segment'][0]['leg'][0]['arrivalTime'] %>
            <br>
            Departure Time: <%= flight['slice'][0]['segment'][0]['leg'][0]['departureTime'] %>
            <br>
            Miles Per Dollar (mp$) =  <%= ((flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i + 0.0) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i + 0.0)).round(2) %> mp$
            <br>
            This is a great deal!!
            <br>
            <hr>

         </div>
          <%# elsif (flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i) > 8 %>
          <!-- Miles Per Dollar (mp$) =  <%= (flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i) %> mp$ -->
          <!-- <br> -->
          <!-- This is a decent deal -->
          <!-- <br> -->
        <%# else %>
          <!-- Miles Per Dollar (mp$) =  <%= (flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i) %> mp$ -->
          <!-- <br> -->
          <!-- This is a bad deal -->
          <!-- <br> -->
        <% end %>

      <% else %>
        mileage is 0 and you cannot get price per mile because you cannot divide by 0
      <% end %>
       <br>

    <% end %>
  </div>
  <div class="col-md-4">
    <h4> > 5 < 10 mp$</h4>
    <h4> These flights are decent deals</h4>
    <% @flights['trips']['tripOption'].each do |flight| %>
    <!-- #code to not divide by zero -->
      <% if (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i) != 0  %>
        <!-- #check ratio -->
        <% if ((flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i + 0.0) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i + 0.0)).round(2) > 5 && ((flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i + 0.0) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i + 0.0)).round(2) < 9.99 %>
          <div class="flight-div">
            <!-- This returns the final destination, if trips have a stop -->
            <strong><%= flight['saleTotal'] %></strong> ______ <%= flight['slice'][0]['segment'][0]['leg'][0]['departureTime'] %> - <%= flight['slice'][0]['segment'][0]['leg'][0]['arrivalTime'] %> ____
            <% if flight['slice'][0]['segment'].length === 0 %>
               "Nonstop"
               <% end %>
             Origin =  <%= flight['slice'][0]['segment'][0]['leg'][0]['origin'] %>
             <br>
          Final Destination =  <%= flight['slice'][0]['segment'].last['leg'][0]['destination'] %>
            <br>

          Number of stops =  <%= flight['slice'][0]['segment'].length - 1 %>
            <br>

            <%# flight['slice'][0]['segment'].each do |segment| %>
              <!-- Destination(not accurate if multiple stops)-   -->
              <%# segment['leg'][0]['destination'] %>
              <!-- <br> -->
            <%# end %>


            <br>
            Total Travel Time: <%= flight['slice'][0]['duration'] %> - Minutes
            <br>
            Airline Carrier <%= flight['slice'][0]['segment'][0]['flight']['carrier'] %>
            <br>
            Airline Number <%= flight['slice'][0]['segment'][0]['flight']['number'] %>
            <br>
            Price: <%= flight['saleTotal'] %>
            <br>
            Mileage: <%= flight['slice'][0]['segment'][0]['leg'][0]['mileage'] %>
            <br>
            Arrival Time: <%= flight['slice'][0]['segment'][0]['leg'][0]['arrivalTime'] %>
            <br>
            Departure Time: <%= flight['slice'][0]['segment'][0]['leg'][0]['departureTime'] %>
            <br>
            Miles Per Dollar (mp$) =  <%= ((flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i + 0.0) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i + 0.0)).round(2) %> mp$
            <br>
            This is a great deal!!
            <br>
            <hr>

         </div>
          <%# elsif (flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i) > 8 %>
          <!-- Miles Per Dollar (mp$) =  <%= (flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i) %> mp$ -->
          <!-- <br> -->
          <!-- This is a decent deal -->
          <!-- <br> -->
        <%# else %>
          <!-- Miles Per Dollar (mp$) =  <%= (flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i) %> mp$ -->
          <!-- <br> -->
          <!-- This is a bad deal -->
          <!-- <br> -->
        <% end %>

      <% else %>
        mileage is 0 and you cannot get price per mile because you cannot divide by 0
      <% end %>
       <br>

    <% end %>

  </div>
  <div class="col-md-4">
    <h4> < 5 mp$</h4>
    <h4>These are terrible deals.</h4>
    <% @flights['trips']['tripOption'].each do |flight| %>
    <!-- #code to not divide by zero -->
      <% if (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i) != 0  %>
        <!-- #check ratio -->
        <% if ((flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i + 0.0) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i + 0.0)).round(2) < 4.99  %>
          <div class="flight-div">
            <!-- This returns the final destination, if trips have a stop -->
            <strong><%= flight['saleTotal'] %></strong> ______ <%= flight['slice'][0]['segment'][0]['leg'][0]['departureTime'] %> - <%= flight['slice'][0]['segment'][0]['leg'][0]['arrivalTime'] %> ____
            <% if flight['slice'][0]['segment'].length === 0 %>
               "Nonstop"
               <% end %>
             Origin =  <%= flight['slice'][0]['segment'][0]['leg'][0]['origin'] %>
             <br>
          Final Destination =  <%= flight['slice'][0]['segment'].last['leg'][0]['destination'] %>
            <br>

          Number of stops =  <%= flight['slice'][0]['segment'].length - 1 %>
            <br>

            <%# flight['slice'][0]['segment'].each do |segment| %>
              <!-- Destination(not accurate if multiple stops)-   -->
              <%# segment['leg'][0]['destination'] %>
              <!-- <br> -->
            <%# end %>


            <br>
            Total Travel Time: <%= flight['slice'][0]['duration'] %> - Minutes
            <br>
            Airline Carrier <%= flight['slice'][0]['segment'][0]['flight']['carrier'] %>
            <br>
            Airline Number <%= flight['slice'][0]['segment'][0]['flight']['number'] %>
            <br>
            Price: <%= flight['saleTotal'] %>
            <br>
            Mileage: <%= flight['slice'][0]['segment'][0]['leg'][0]['mileage'] %>
            <br>
            Arrival Time: <%= flight['slice'][0]['segment'][0]['leg'][0]['arrivalTime'] %>
            <br>
            Departure Time: <%= flight['slice'][0]['segment'][0]['leg'][0]['departureTime'] %>
            <br>
            Miles Per Dollar (mp$) =  <%= ((flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i + 0.0) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i + 0.0)).round(2) %> mp$
            <br>
            This is a great deal!!
            <br>
            <hr>

         </div>
          <%# elsif (flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i) > 8 %>
          <!-- Miles Per Dollar (mp$) =  <%= (flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i) %> mp$ -->
          <!-- <br> -->
          <!-- This is a decent deal -->
          <!-- <br> -->
        <%# else %>
          <!-- Miles Per Dollar (mp$) =  <%= (flight['slice'][0]['segment'][0]['leg'][0]['mileage'].to_i) / (flight['saleTotal'].gsub(/[^\d\.-]/,'').to_i) %> mp$ -->
          <!-- <br> -->
          <!-- This is a bad deal -->
          <!-- <br> -->
        <% end %>

      <% else %>
        mileage is 0 and you cannot get price per mile because you cannot divide by 0
      <% end %>
       <br>

    <% end %>

  </div>
</div>

  <% else %>
  <h1>Please Sign in to view fligts</h1>
<% end %>
